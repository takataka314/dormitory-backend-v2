<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>物品一括追加</title>
<style>
body { font-family: Arial; padding: 20px; }
input, select { padding: 6px; margin-right: 10px; margin-bottom: 10px; }
button { padding: 6px 12px; }
table { border-collapse: collapse; width: 100%; margin-top: 10px; }
th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
th { background: #eee; }
</style>
</head>
<body>

<h1>物品一括追加（スタッフ専用）</h1>

<!-- 入力エリア -->
<div>
  <input type="text" id="category" placeholder="カテゴリー">
  <input type="text" id="name" placeholder="物品名">
  <input type="number" id="stock" placeholder="個数" min="1">
  <button onclick="addItemToList()">リストに追加</button>
</div>

<h3>追加予定リスト</h3>
<table id="itemsList">
  <thead>
    <tr>
      <th>カテゴリー</th>
      <th>物品名</th>
      <th>個数</th>
      <th>削除</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<br>
<button onclick="submitItems()">一括追加</button>

<br><br>
<a href="/staff_menu.html">← スタッフメニューに戻る</a>


<script>
let itemsToAdd = [];

// ---------------------------
// リストに追加
// ---------------------------
function addItemToList() {
  const category = document.getElementById('category').value.trim();
  const name = document.getElementById('name').value.trim();
  const stock = parseInt(document.getElementById('stock').value);

  if (!category || !name || !stock || stock <= 0) {
    alert("カテゴリー・名前・個数を正しく入力してください");
    return;
  }

  itemsToAdd.push({ category, name, stock });
  renderItems();

  // 入力欄をクリア
  document.getElementById('category').value = "";
  document.getElementById('name').value = "";
  document.getElementById('stock').value = "";
}

// ---------------------------
// リスト表示
// ---------------------------
function renderItems() {
  const tbody = document.querySelector("#itemsList tbody");
  tbody.innerHTML = "";

  itemsToAdd.forEach((item, idx) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${item.category}</td>
      <td>${item.name}</td>
      <td>${item.stock}</td>
      <td><button onclick="removeItem(${idx})">削除</button></td>
    `;
    tbody.appendChild(tr);
  });
}

// ---------------------------
// 1行削除
// ---------------------------
function removeItem(index) {
  itemsToAdd.splice(index, 1);
  renderItems();
}

// ---------------------------
// 一括送信
// ---------------------------
async function submitItems() {
  if (itemsToAdd.length === 0) {
    alert("追加する物品がありません");
    return;
  }

  let errors = [];

  for (const item of itemsToAdd) {
    const res = await fetch("/api/items", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(item)
    });

    const data = await res.json();
    if (!data.ok) {
      errors.push(item.name);
    }
  }

  if (errors.length === 0) {
    alert("すべて追加されました！");
  } else {
    alert("追加失敗:\n" + errors.join("\n"));
  }

  itemsToAdd = [];
  renderItems();
}
</script>

</body>
</html>
